<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>フレーズ一覧</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <header>
      <a href="{{ url_for('index') }}" class="h1_button">
          <h1>Welcome, {{ username }}!</h1>
      </a>
    </header>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash-messages">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- 検索フォーム -->
    <section id="search">
      <form action="{{ url_for('index') }}" method="get" class="form-container">
        <input type="text" name="q" placeholder="キーワードで絞り込む" value="{{ query }}">
        <button type="submit">検索</button>
      </form>

      {% if query %}
        <p>「{{ query }}」 の検索結果：{{ phrases|length }} 件</p>
        <!-- ↓ ここを追加 ↓ -->
        <a href="{{ url_for('index') }}" class="form-container__reset-btn">
          ← 全件表示に戻る
        </a>
      {% endif %}
    </section>

      <hr>
    <div class="layout">
      <div class="sidebar">
        <!-- サイドバー -->
        <a href="{{ url_for('index') }}" class="home_button">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="#8B5E3C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V9.5z"/>
          </svg>
        </a>
        <a href="{{ url_for('add_phrase') }}">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="#8B5E3C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
        </a>
        <a href="{{ url_for('show_favorite')}}">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="#DAA520" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
        </a>
        <a href="{{ url_for('show_deleted_phrases') }}">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="#8B5E3C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
              <path d="M10 11v6"/>
              <path d="M14 11v6"/>
              <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
          </svg>
        </a>
      </div>

        <!-- フレーズ一覧 -->
        <section id="phrases">
          {% for p in phrases %}
            <div class="phrase-card">
              <form action="{{ url_for('delete_phrase', id=p['id']) }}" method="POST" class="delete-form">
                <button type="submit" class="btn-delete" onclick="return confirm('削除しますか？')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
              </form>

              <form action="{{ url_for('toggle_favorite', phrase_id=p.id) }}" method="POST">
                <button type="button"
                        class="fav-btn {{ 'filled' if p.is_favorite else 'outline' }}"
                        data-id="{{ p.id }}"
                        data-fav="{{ 'true' if  p.is_favorite else 'false' }}"
                        aria-label="お気に入り切り替え">
                  {% if p.is_favorite %}
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24" height="24" viewBox="0 0 24 24"
                         fill="yellow" stroke="black" stroke-width="2">
                      <path d="M12 .587l3.668 7.568L24 9.423l-6 5.847L19.335 24
                               12 19.77 4.665 24 6 15.27 0 9.423l8.332-1.268z"/>
                    </svg>
                  {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="black" stroke-width="2">
                      <path d="M12 .587l3.668 7.568L24 9.423l-6 5.847L19.335 24
                               12 19.77 4.665 24 6 15.27 0 9.423l8.332-1.268z"/>
                    </svg>
                  {% endif %}
                </button>
              </form>

              <div class="category
                {% if p.category == '挨拶' %}category-greeting
                {% elif p.category == '案内' %}category-guide
                {% elif p.category == '支払い' %}category-payment
                {% elif p.category == 'お礼' %}category-thanks
                {% elif p.category == 'その他' %}category-other
                {% endif %}">{{ p.category }}
              </div>
              <div class="text-line">{{ p.jp }}</div>
              <div class="text-line">{{ p.en }}</div>
              <div class="text-line">{{ p.ne }}</div>
              {% if p.audio_filename %}
                <audio controls src="{{ url_for('static', filename='audio/' + p.audio_filename) }}"></audio>
              {% endif %}
            </div>
          {% endfor %}
          {% if not phrases %}
            <p>該当するフレーズがありません。</p>
          {% endif %}
        </section>
    </div>
    <script src="{{ url_for('static', filename='js/favorite.js') }}"></script>
  </body>
  <hr>
  <footer>
    <div class="header-actions">
      <a href="{{ url_for('add_phrase') }}">フレーズ追加</a>
      <a href="{{ url_for('logout') }}">ログアウト</a>
    </div>
  </footer>
</html>
